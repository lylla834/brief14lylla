BRIEF 14

Objectif : Déploiement d'une infrastructure avec Terraform, construction d'un conteneur Docker,
envoi de l'image sur Docker Hub et orchestration du déploiement sur deux machines virtuelles à l'aide de Jenkins

script pour installation docker dans terraform :

#!/bin/bash

#Installing Docker

sudo apt-get update
sudo apt install docker.io -y
sudo groupadd docker
sudo usermod -aG docker $USER
sudo systemctl enable docker.service
sudo systemctl enable containerd.service


#Creating container

sudo git clone https://github.com/samzri1/brief14.git
sudo docker build -t img_app_py .
sudo docker run --name cont_appy_py_lylla -p 8080:1234 -d img_app_py
sudo docker tag img_app_py:latest lyllabani/img_app_py:latest
sudo docker login -u lyllabani -p dckr_pat_BPdule2UQ-Mif_zdZGq6E5R24EA
sudo docker push lyllabani/img_app_py:latest


Pensez à configuer le serveur Jenkins avec tous les logiciels necessaire : ici ajout de plugin Terraform et git 


CREATION JENKINSFILE :

pipeline {
    agent any
    
    stages {
        stage('git') {
            steps {
                checkout scmGit(branches: [[name: '*/main']], extensions: [], userRemoteConfigs: [[url: 'https://github.com/lylla834/brief14lylla']])
            }
        }  
        stage('Terraform init') {
            steps {
                sh "terraform init"
            }
        }
        
        stage('Terraform plan') {
            steps {
                sh "terraform plan"
            }
        }
        
        stage('Terraform apply') {
            steps {
                sh "terraform apply -auto-approve"
            }
        }
    
        stage ('Terraform-Init Prod') {
            steps {
                sh "cd prod && terraform init"
            }                
        }

        stage ('Terraform-Plan Prod') {
            steps {
                sh "cd prod && terraform plan"
            }
        }

        stage ('Terraform-Apply Prod') {
            steps {
                sh "cd prod && terraform apply -auto-approve"
            }
        }  
    }
}




INSTALLATION MONITORING /

-allez sur AZURE puis
- RESSOURCE_GROUPE
- INSIGHT
- CALCULER
- VM
- SUPERVION à coter de propriété
Puis 
ENABLE ACTIVER 


